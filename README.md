# Dependency Visualizer - Инструмент визуализации графа зависимостей

## Общее описание

Dependency Visualizer - это CLI-инструмент для анализа и визуализации графов зависимостей пакетов Rust (Cargo). Программа позволяет исследовать зависимости пакетов, обнаруживать циклические зависимости, анализировать порядок загрузки и сравнивать результаты с реальным менеджером пакетов Cargo.

**Ключевые особенности:**
- Поддержка работы с реальными репозиториями crates.io
- Режим тестирования с локальными файлами
- Обнаружение циклических зависимостей
- Анализ порядка загрузки зависимостей
- Фильтрация пакетов по подстроке
- Ограничение глубины анализа

## Функции и настройки

### Основные функции

1. **Анализ прямых зависимостей** - получение списка непосредственных зависимостей пакета
2. **Построение полного графа зависимостей** - BFS-обход с учетом транзитивности
3. **Обнаружение циклов** - выявление циклических зависимостей в графе
4. **Визуализация дерева** - ASCII-представление иерархии зависимостей
5. **Анализ порядка загрузки** - топологическая сортировка и сравнение с Cargo
6. **Статистика графа** - подсчет пакетов, зависимостей и циклов

### Параметры командной строки

| Параметр | Тип | Описание |
|----------|-----|-----------|
| `--package` | string | Имя анализируемого пакета |
| `--repo-url` | string | URL репозитория crates.io |
| `--repo-path` | string | Путь к файлу тестового репозитория |
| `--test-repo` | flag | Режим работы с тестовым репозиторием |
| `--max-depth` | integer | Максимальная глубина анализа (по умолчанию: 3) |
| `--filter` | string | Подстрока для фильтрации пакетов |

### Формат URL репозитория

URL должен соответствовать формату crates.io API:
```
https://crates.io/api/v1/crates/{package_name}/{version}/dependencies
```

### Формат тестовых файлов

**JSON-формат:**
```json
{
  "package_a": ["dependency1", "dependency2"],
  "package_b": ["dependency3"],
  "dependency1": ["dependency4"]
}
```

**Текстовый формат:**
```
package_a: dependency1, dependency2
package_b: dependency3
dependency1: dependency4
```

## Сборка и запуск

### Требования

- Python 3.7+
- Установленные зависимости:
  ```bash
  pip install requests
  ```

### Запуск приложения

```bash
# Работа с реальным репозиторием
python script.py --package tokio --repo-url "https://crates.io/api/v1/crates/tokio/1.35.1/dependencies" --max-depth 2

# Работа с тестовым репозиторием
python script.py --package app --repo-path test_simple.json --test-repo --max-depth 3

# С фильтрацией пакетов
python script.py --package web_server --repo-path test_complex.json --test-repo --filter "file" --max-depth 2
```

### Создание тестовых файлов

Программа автоматически создает тестовые файлы при первом запуске:
- `test_simple.json` - простой граф зависимостей
- `test_cyclic.json` - граф с циклическими зависимостями
- `test_complex.json` - сложный граф для демонстрации порядка загрузки

## Примеры использования

### Пример 1: Анализ зависимостей Tokio

```bash
python script.py --package tokio --repo-url "https://crates.io/api/v1/crates/tokio/1.35.1/dependencies" --max-depth 1
```

**Результат:**
- Отображение конфигурации
- Список прямых зависимостей Tokio
- Статистика графа
- ASCII-дерево зависимостей

### Пример 2: Анализ тестового репозитория с циклами

```bash
python script.py --package package_a --repo-path test_cyclic.json --test-repo --max-depth 5
```

**Результат:**
- Обнаружение циклических зависимостей
- Визуализация циклов в формате A → B → C → A
- Статистика с количеством найденных циклов

### Пример 3: Анализ порядка загрузки

```bash
python script.py --package web_server --repo-path test_complex.json --test-repo --max-depth 4
```

**Результат:**
- Расчетный порядок загрузки зависимостей
- Сравнение с реальным менеджером пакетов (заглушка)
- Анализ расхождений и их причин

### Пример 4: Использование фильтра

```bash
python script.py --package web_server --repo-path test_complex.json --test-repo --filter "crypto" --max-depth 3
```

**Результат:**
- Исключение пакетов, содержащих "crypto" из анализа
- Статистика по отфильтрованным зависимостям

## Структура вывода

Программа выводит информацию в четыре этапа:

1. **Этап 1**: Конфигурация приложения
2. **Этап 2**: Сбор данных о прямых зависимостях  
3. **Этап 3**: Построение графа зависимостей
4. **Этап 4**: Анализ порядка загрузки зависимостей

## Обработка ошибок

Программа обрабатывает следующие типы ошибок:
- Невалидные аргументы командной строки
- Ошибки сетевых запросов к crates.io
- Ошибки парсинга JSON
- Ошибки чтения файлов тестовых репозиториев
- Циклические зависимости

## Особенности реализации

- **Алгоритм BFS** для обхода графа без рекурсии
- **Кэширование запросов** для оптимизации производительности
- **Топологическая сортировка** для определения порядка загрузки
- **DFS для обнаружения циклов** с отслеживанием пути
- **Поддержка различных форматов** тестовых файлов

## Ограничения

- Реальное сравнение с Cargo реализовано как заглушка
- Глубина анализа ограничена для предотвращения бесконечных циклов
- Сетевые запросы могут занимать время при большом количестве зависимостей